function sel(cond, t, f)
    if cond then return t else return f end
end

local build = include("../../build/build.knit")
local conf = include("../../build/default.knit")

local machine = build.machine(conf.board, false)
if machine == nil then
    return "could not find machine for board " .. conf.board
end

local darch = sel(machine.arch == "aarch64", "-DAARCH64", "-DRISCV64")

local tools = build.tools(machine)
local flags = build.flags(machine, conf.lto, conf.release, false)

return b{
    $ hello.elf: hello.c ../syslib/syslib.c ../syslib/syscall.h[I]
        $(tools.cc) $(flags.cc) -mgeneral-regs-only $input -o $output -I../syslib -nostartfiles -nostdlib $darch ~/programming/newlib-cygwin/newlib-aarch64-none-elf/libc.a
    $ hello.bin: hello.elf
        $(tools.objcopy) $input -O binary $output
    $ hello.list: hello.elf
        $(tools.objdump) -D $input > $output
}
